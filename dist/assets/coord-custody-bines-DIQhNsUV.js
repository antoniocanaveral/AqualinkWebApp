import{cd as ie,u as ae,bl as te,am as ne,t as g,F as C,r as m,dK as re,dW as E,a6 as le,j as e,P as oe,M as ce,e as x,f as c,ec as de,X as f,dL as ue,dM as me,dN as he,H as p,S as xe,dQ as L,dm as fe,D as $,ed as ge,B as b,$ as H,ee as pe,ef as je,cw as K,p as N,dR as be,y as ye,dT as Se,Y as ve,z as _e,eg as ke,aH as y,ca as Ce}from"./index-BJIB_XH5.js";import{A as we}from"./alerts-FhWXB3ta.js";import{a as Be,b as Ie,c as Me}from"./actionCreator-C0Hhk0tU.js";const{Option:Pe}=N;function ze(){const q=[{path:"index",breadcrumbName:ie.get("orgName")},{path:"first",breadcrumbName:"Coordinación"}],l=ae();te();let{id:S}=ne();const i=g(s=>s.custody.coordination),U=g(s=>s.custody.loading),{organizationBins:w=[],organizationSecurityKits:O}=g(s=>s.bin_drawers||{}),T=g(s=>s.custody.bines),D=g(s=>s.custody.fishingId),[W]=C.useForm(),[r,u]=m.useState({status:"process",isFinished:!1,current:0,showForm:!1,suggestedBinesCount:0,form:{binId:"",binNumber:"",seal1:"",seal2:"",seal3:"",seal4:""},bineForm:{bineIce:"",bineMetabisulfito:""},selectedTreater:void 0}),{treaters:v,treatersLoading:Y}=g(s=>s.bin_drawers||{}),{status:P,isFinished:V,current:h}=r,[G,B]=m.useState(!1),[o,j]=m.useState([]),[_,I]=m.useState(null),Q=s=>{if(!s.SM_Fishing_ID)if(_===null)o.find(a=>a.id===s.id)?(j(o.filter(a=>a.id!==s.id)),I(null)):(j([...o,s]),I(s.id));else{if(s.id!==_){const a=Math.min(_,s.id),n=Math.max(_,s.id),t=w.filter(F=>F.id>=a&&F.id<=n&&!F.SM_Fishing_ID),d=Array.from(new Set([...o,...t]));j(d)}else j(o.filter(a=>a.id!==s.id));I(null)}};m.useEffect(()=>{l(re(S,()=>{})),l(E(S,(s,a)=>{}))},[l,S]),m.useEffect(()=>{l(Be()),l(Ie("BIN")),l(Me())},[l]),m.useLayoutEffect(()=>{const s=document.querySelectorAll(".ant-steps-item-active"),a=document.querySelectorAll(".ant-steps-item-finish");s.forEach(n=>{if(n.previousSibling){const t=n.previousSibling;t.classList.contains("success-step-item")?t.classList.remove("success-step-item"):t.classList.remove("wizard-step-item"),t.classList.add("wizard-steps-item-active")}}),a.forEach(n=>{if(n.previousSibling){const t=n.previousSibling;t.classList.remove("wizard-steps-item-active"),t.classList.add("success-step-item")}})});const k=()=>{let s=0;return i&&(s=Number(Math.ceil(parseFloat(i.fishing_volume)/1200)).toFixed(0)),s},X=()=>new Promise((s,a)=>{h===0?(u({...r,status:"process",current:h+1}),s()):h===1?se()?W.validateFields().then(()=>{u({...r,status:"process",current:h+1}),s()}).catch(n=>{y.error("Revise los datos requeridos!"),a(n)}):(y.error(`Debe registrar al menos ${k()} bines.`),a()):a()}),J=()=>new Promise((s,a)=>{h>0?(u({...r,status:"process",current:h-1}),s()):a()}),Z=()=>{if(window.confirm("Confirma que desea enviar esta información de Bines?")){const{bineIce:a,bineMetabisulfito:n}=r.bineForm;l(ke(D,r.selectedTreater,i.SM_Coordination_ID.id,a,n,t=>{t?u({...r,status:"finish",isFinished:!0,current:0}):y.error("Ocurrió un error al enviar la coordinación.")}))}},z=()=>{u({...r,showForm:!1,form:{...r.form,binId:null,binNumber:null,seal1:null,seal2:null,seal3:null,seal4:null}})},ee=()=>{let s=0;return T&&(s=T.length),s},se=()=>ee()>=k(),R=[{key:"1",label:"Camaronera:",value:i?i.org_name:"-"},{key:"2",label:"Piscina:",value:i?i.warehouse_name:"-"},{key:"3",label:"Dirección:",value:i?`${i.City} ${i.Address1}, ${i.Address2}`:"-"},{key:"4",label:"Notificación:",value:i?i.SM_FishingNotification:"-"},{key:"5",label:"Fecha de Pesca Confirmada:",value:i?le(i.answered_date).format("DD-MM-YYYY HH:mm"):"-"},{key:"6",label:"Tipo de Pesca:",value:i?i.fishing_type:"-"},{key:"7",label:"Tipo de Contenedor:",value:i?i.container_type:"-"},{key:"8",label:"Volumen de Pesca:",value:i?`${i.fishing_volume} lbs`:"-"},{key:"9",label:"Clasificación:",value:i?i.Classification:"-"},{key:"10",label:"Textura:",value:i?i.texture:"-"}],M=(()=>{const s=new Set(w.map(t=>t.SM_SecurityKits_ID&&t.SM_SecurityKits_ID.id).filter(t=>t!=null)),n=[...O.filter(t=>!s.has(t.id))];return o.map(t=>{if(n.length>0){const d=n.shift();return{key:t.id,bin:t.Name,sm_securitykits_id:d.id,sm_kitcode:d.sm_kitcode,seal1:d.SM_Stamp1,seal2:d.SM_Stamp2,seal3:d.SM_Stamp3,seal4:d.SM_Stamp4,sm_tag:d.sm_tag}}return null}).filter(t=>t!==null)})(),A=[{title:"No. Bin",dataIndex:"bin",key:"bin"},{title:"Kit de Seguridad",dataIndex:"sm_kitcode",key:"sm_kitcode"},{title:"SM_Stamp1",dataIndex:"seal1",key:"seal1"},{title:"SM_Stamp2",dataIndex:"seal2",key:"seal2"},{title:"SM_Stamp3",dataIndex:"seal3",key:"seal3"},{title:"SM_Stamp4",dataIndex:"seal4",key:"seal4"},{title:"sm_tag",dataIndex:"sm_tag",key:"sm_tag"},{title:"Acciones",key:"actions",render:(s,a)=>e.jsx(b,{type:"danger",icon:e.jsx(Ce,{}),onClick:()=>{j(o.filter(n=>n.id!==a.key))},children:"Eliminar"})}];return e.jsxs(e.Fragment,{children:[e.jsx(oe,{onBack:()=>window.history.back(),title:`Bines para coordinación: ${i?i.SM_FishingNotification:"-"}`,routes:q}),e.jsx(ce,{children:e.jsx(x,{gutter:25,children:e.jsx(c,{sm:24,xs:24,children:e.jsx(m.Suspense,{fallback:e.jsx(f,{headless:!0,children:e.jsx(ve,{paragraph:{rows:20},active:!0})}),children:e.jsx(de,{children:e.jsx(f,{headless:!0,children:e.jsx(x,{justify:"center",children:e.jsx(c,{xxl:20,xs:24,children:e.jsx(ue,{className:"ninjadash-wizard-page",children:e.jsx(me,{children:e.jsx(he,{isswitch:!0,current:h,status:P,steps:[{title:"Coordinación",className:"wizard-step-item",icon:e.jsx(fe,{}),content:e.jsx(x,{justify:"center",children:e.jsxs(c,{sm:22,xs:24,children:[e.jsxs(p,{as:"h4",children:["1. Datos de la Coordinación ",U&&e.jsx(xe,{})]}),e.jsx(L,{data:R,pairsPerRow:2})]})})},{title:"Información de Bines",className:"wizard-step-item",icon:e.jsx(be,{}),content:e.jsx($,{className:"basic-form-inner",style:{width:"80%"},children:e.jsx("div",{className:"atbd-form-checkout",children:e.jsx(x,{justify:"center",children:e.jsx(c,{sm:22,xs:24,children:e.jsxs("div",{className:"shipping-form",children:[e.jsx(p,{as:"h4",children:"2. Información de Bines"}),e.jsx("div",{style:{marginBottom:15},children:e.jsx(we,{showIcon:!0,icon:e.jsx(ge,{}),message:"Cantidad de Bines",description:`El volumen de pesca es ${i?i.fishing_volume:""} lbs, cada bin tiene una capacidad máxima de 1200 lbs, para poder enviar la información de esta coordinación necesita registrar al menos un total de ${k()} bin${k()>1?"es":""}.`,type:"info"})}),e.jsxs(c,{span:24,children:[e.jsx(b,{type:"primary",onClick:()=>B(!0),children:"Seleccionar Bines"}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:"10px"},children:e.jsx(H,{dataSource:M,columns:A,pagination:!1})}),e.jsx("br",{}),e.jsx(x,{justify:"center",gutter:16,style:{marginBottom:15},children:e.jsx(c,{xs:24,sm:24,md:12,lg:12,xl:12,className:"gutter-row",children:e.jsxs("div",{style:{marginBottom:15},children:[e.jsxs(b,{size:"default",type:"primary",onClick:()=>{l(je(D,M,(s,a)=>{s?(y.success("Los bins se registraron con éxito!"),l(E(S,()=>{z()}))):y.error(a)}))},children:[e.jsx(pe,{}),"Guardar"]}),e.jsx(b,{size:"default",type:"default",onClick:()=>z(),children:"Cancelar"})]})})})]})]}),e.jsxs(x,{justify:"center",gutter:16,style:{marginBottom:15},children:[e.jsx(c,{xs:24,sm:24,md:12,lg:12,xl:6,className:"gutter-row",children:e.jsx(C.Item,{name:"bineIce",label:"Hielo (#Sacos)",rules:[{required:!0,message:"Por favor ingrese la cantidad de hielo"}],children:e.jsx(K,{value:r.bineForm.bineIce,onChange:s=>{u({...r,bineForm:{...r.bineForm,bineIce:s}})}})})}),e.jsx(c,{xs:24,sm:24,md:12,lg:12,xl:6,className:"gutter-row",children:e.jsx(C.Item,{name:"bineMetabisulfito",label:"Metabisulfitos (kg)",rules:[{required:!0,message:"Por favor ingrese la cantidad de metabisulfitos"}],children:e.jsx(K,{value:r.bineForm.bineMetabisulfito,onChange:s=>{u({...r,bineForm:{...r.bineForm,bineMetabisulfito:s}})}})})}),v.length>0?e.jsx(c,{sm:8,xs:24,children:e.jsx(C.Item,{name:"selectedTreater",label:"Seleccionar Tratador",rules:[{required:!0,message:"Por favor seleccione un tratador"}],children:e.jsx(N,{loading:Y,placeholder:"Selecciona un tratador",allowClear:!0,value:r.selectedTreater,onChange:s=>u({...r,selectedTreater:s}),children:v==null?void 0:v.map(s=>e.jsx(N.Option,{value:s.value,children:s==null?void 0:s.label},s==null?void 0:s.value))})})}):null]})]})})})})})},{title:"Resumen",className:"wizard-step-item",icon:e.jsx(Se,{}),content:P!=="finish"?e.jsxs($,{style:{width:"100%"},children:[e.jsx(p,{as:"h4",children:"3. Resumen"}),e.jsxs(f,{bodyStyle:{borderRadius:10},headless:!0,children:[e.jsx("div",{className:"atbd-review-order__single",children:e.jsx(f,{headless:!0,children:e.jsxs("div",{className:"atbd-review-order__shippingTitle",children:[e.jsx(p,{as:"h5",children:"Coordinación"}),e.jsx(L,{data:R,pairsPerRow:2})]})})}),e.jsx("div",{className:"atbd-review-order__single",children:e.jsxs(f,{headless:!0,children:[e.jsx("div",{children:e.jsx(p,{as:"h5",children:"Información de Bines"})}),o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginTop:"10px"},children:e.jsx(H,{dataSource:M,columns:A,pagination:!1})}),e.jsx("br",{})]})]})})]})]}):e.jsx(x,{justify:"center",style:{width:"100%"},children:e.jsx(c,{xl:21,xs:24,children:e.jsx("div",{className:"checkout-successful",children:e.jsx(f,{headless:!0,bodyStyle:{borderRadius:"20px"},children:e.jsxs(f,{headless:!0,children:[e.jsx("span",{className:"icon-success",children:e.jsx(ye,{})}),e.jsx(p,{as:"h3",children:"Información de Bines enviada"})]})})})})})}],onNext:X,onPrev:J,onDone:Z,isfinished:V})})})})})})})})})})}),e.jsx(_e,{title:"Asignar Bines",visible:G,onOk:()=>B(!1),onCancel:()=>B(!1),width:1e3,children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"5px",maxHeight:"400px",overflowY:"auto"},children:w.map(s=>{const a=s.SM_Fishing_ID!==null&&s.SM_Fishing_ID!==void 0,n=o.find(t=>t.id===s.id);return e.jsx(b,{style:{height:"40px",padding:0,backgroundColor:a?"#f5222d":n?"#1890ff":"#fff",color:a?"#fff":"#000"},disabled:a,onClick:()=>Q(s),children:s.Name},s.id)})})})]})}export{ze as default};
