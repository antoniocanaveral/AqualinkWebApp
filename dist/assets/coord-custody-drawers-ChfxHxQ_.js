import{u as he,am as fe,t as S,r as f,ef as xe,F as x,dK as ge,dX as ve,j as e,L as X,w as J,ca as pe,eg as je,a6 as we,P as Se,M as be,e as g,f as c,ea as ye,X as p,dL as Ce,dM as _e,dN as ke,H as F,S as Q,dQ as $,dm as Fe,D as De,eb as Ie,cw as M,p as b,eh as Me,B as N,ec as Ne,aH as m,ei as Ve,dJ as Z,dR as Te,y as Ee,dT as Pe,Y as $e,ej as ze,ek as Ae,el as qe,dY as ee}from"./index-zxEALkft.js";import{A as Ge}from"./alerts-BNetvTiV.js";import{c as Be,a as Le,f as Re,b as Ke}from"./actionCreator-DtQqcJ92.js";function Oe(){var U,W;const o=he();let{id:j}=fe();const i=S(s=>s.custody.coordination),z=S(s=>s.custody.loading),V=S(s=>s.custody.drawerStamps),T=S(s=>s.custody.fishingId),{carriers:y,error:He}=S(s=>s.carriers),[C,se]=f.useState(null);f.useEffect(()=>{o(xe()),o(Be()),o(Le("VAN")),o(Re(j)),o(Ke())},[o]);const[d]=x.useForm(),[a,u]=f.useState({status:"process",isFinished:!1,current:0,showForm:!1,suggestedDrawerCount:0,form:{sealId:"",seal:"",van:"",drawers:0},drawerForm:{drawerId:"",drawerCount:"",drawerIce:"",drawerMetabisulfito:""},sm_ice:void 0,sm_metabisulfite:void 0,selectedTreater:void 0}),{organizationSecurityKits:A=[],organizationFishingDrawerStamp:D=[],fishingDrawerInfo:E,fishingDrawerInfoLoading:q,treaters:_,treatersLoading:ae}=S(s=>s.bin_drawers||{}),[w,P]=f.useState([]),[re,G]=f.useState([]),[ie,B]=f.useState([]);f.useEffect(()=>{G(A);const s=new Set(D.map(t=>t.sm_vehicle_id).filter(t=>t!=null)),r=y.flatMap(t=>t.sm_vehicle.filter(n=>!s.has(n.id)));B(r)},[A,D,y]),f.useEffect(()=>{if(!q&&E.length>0){const s=E.map(r=>({van:r.sm_furgon,kitCode:r.sm_kitcode,seal1:r.SM_Stamp1,seal2:r.SM_Stamp2,drawerCaladas:r.sm_kdrawerscount,drawerSolidas:r.sm_sdrawerscount}));P(s)}},[E,q]);const L=[{title:"Furgón",dataIndex:"van",key:"van"},{title:"Kit de Seguridad",dataIndex:"kitCode",key:"kitCode"},{title:"Sello 1",dataIndex:"seal1",key:"seal1"},{title:"Sello 2",dataIndex:"seal2",key:"seal2"},{title:"Gavetas Caladas",dataIndex:"drawerCaladas",key:"drawerCaladas"},{title:"Gavetas Sólidas",dataIndex:"drawerSolidas",key:"drawerSolidas"},{title:"Acciones",key:"actions",render:(s,r)=>e.jsx(N,{type:"danger",onClick:()=>{qe(r.van,(t,n)=>{t?P(w.filter(v=>v.van!==r.van)):n.error(n)})},children:"Eliminar"})}],{status:R,isFinished:te,current:h}=a;console.log(`current ${h}`),f.useEffect(()=>{o(ge(j,(s,r)=>{o(ee(j,(t,n)=>{let v=Number(parseFloat(r.fishing_volume)/45).toFixed(0);u({...a,suggestedDrawerCount:v})}))})),o(ve(j,(s,r)=>{u({...a,current:0,drawerForm:{drawerId:r?r.id:"",drawerIce:r?r.SM_Ice:"",drawerMetabisulfito:r?r.SM_Metabisulfito:""}})}))},[o,j]),f.useLayoutEffect(()=>{const s=document.querySelectorAll(".ant-steps-item-active"),r=document.querySelectorAll(".ant-steps-item-finish");s.forEach(t=>{if(t.previousSibling){const n=t.previousSibling;n.classList.contains("success-step-item")?n.classList.remove("success-step-item"):n.classList.remove("wizard-step-item"),n.classList.add("wizard-steps-item-active")}}),r.forEach(t=>{if(t.previousSibling){const n=t.previousSibling;n.classList.remove("wizard-steps-item-active"),n.classList.add("success-step-item")}})});const le=[];V&&V.length>0&&V.map((s,r)=>le.push({van:e.jsx("span",{children:s.SM_Van}),stamp:e.jsx("span",{children:s.SM_Stamp}),drawers:e.jsx("span",{children:s.SM_DrawersCount}),action:e.jsxs("div",{className:"table-actions",style:{minWidth:"50px !important",textAlign:"center"},children:[e.jsx(X,{className:"edit",title:"Editar",onClick:()=>{u({...a,showForm:!0,form:{...a.form,sealId:s.id,seal:s.SM_Stamp,van:s.SM_Van,drawers:s.SM_DrawersCount}})},children:e.jsx(J,{})}),e.jsx(X,{className:"edit",title:"Eliminar",onClick:()=>{window.confirm("Seguro deseas eliminar el Sello ? ")&&o(je(s.id,(n,v)=>{n?(m.success("El Sello se eliminó con exito!"),o(ee(j,()=>{K()}))):m.error(v)}))},children:e.jsx(pe,{})})]})}));const ne=()=>(console.log(`current ${h}`),new Promise((s,r)=>{h==null?(u({...a,status:"process",current:0}),s()):h===0?(u({...a,status:"process",current:h+1}),s()):h===1?d.validateFields().then(()=>{o(Ae(T,a.drawerForm,(t,n)=>{t?(m.success("Información de gavetas actualizada!"),u({...a,status:"process",current:2}),s()):(m.error(n),r(n))}))}).catch(t=>{m.error("Revise los datos requeridos!"),r(t)}):(m.error(`Debe registrar al menos ${a.suggestedDrawerCount} gavetas.`),r())})),de=()=>new Promise((s,r)=>{console.log(h),h>0?(u({...a,status:"process",current:h-1}),s()):r()}),oe=()=>{if(!a.sm_ice||!a.sm_metabisulfite||!a.selectedTreater){m.error("Por favor completa todos los campos correctamente.");return}window.confirm("Confirma que desea enviar esta información de Gavetas?")&&o(ze(T,i.SM_Coordination_ID.id,a.selectedTreater,a.sm_ice,a.sm_metabisulfite,(r,t)=>{r?(u({...a,status:"finish",isFinished:!0,current:0,sm_ice:void 0,sm_metabisulfite:void 0,selectedTreater:void 0}),m.success("Información de gavetas enviada correctamente.")):m.error(`Error: ${t}`)}))},K=()=>{u({...a,showForm:!1,form:{...a.form,sealId:null,seal:null,van:null,drawers:0}})},H=[{key:"1",label:"Camaronera:",value:i?i.org_name:"-"},{key:"2",label:"Piscina:",value:i?i.warehouse_name:"-"},{key:"3",label:"Dirección:",value:i?`${i.City} ${i.Address1}, ${i.Address2}`:"-"},{key:"4",label:"Notificación:",value:i?i.SM_FishingNotification:"-"},{key:"5",label:"Fecha de Pesca Confirmada:",value:i?we(i.answered_date).format("DD-MM-YYYY HH:mm"):"-"},{key:"6",label:"Tipo de Pesca:",value:i?i.fishing_type:"-"},{key:"7",label:"Tipo de Contenedor:",value:i?i.container_type:"-"},{key:"8",label:"Volumen de Pesca:",value:i?`${i.fishing_volume} lbs`:"-"},{key:"9",label:"Clasificación:",value:i?i.Classification:"-"},{key:"10",label:"Textura:",value:i?i.texture:"-"}],ce=[{key:"3",label:"Hielo",value:`${a.sm_ice} saco${d.getFieldValue("drawerIce")>1?"s":""}`},{key:"4",label:"Metabisulfitos:",value:`${a.sm_metabisulfite} kg`},{key:"5",label:"Tratador:",value:d.getFieldValue("selectedTreater")&&((U=_.find(s=>s.value===d.getFieldValue("selectedTreater")))==null?void 0:U.label)||"No seleccionado"}];return e.jsxs(e.Fragment,{children:[e.jsx(Se,{onBack:()=>window.history.back(),title:`Gavetas para coordinación: ${i?i.SM_FishingNotification:"-"}`}),e.jsx(be,{children:e.jsx(g,{gutter:25,children:e.jsx(c,{sm:24,xs:24,children:e.jsx(f.Suspense,{fallback:e.jsx(p,{headless:!0,children:e.jsx($e,{paragraph:{rows:20},active:!0})}),children:e.jsx(ye,{children:e.jsx(p,{headless:!0,children:e.jsx(g,{justify:"center",children:e.jsx(c,{xxl:20,xs:24,children:e.jsx(Ce,{className:"ninjadash-wizard-page",children:e.jsx(_e,{children:e.jsx(ke,{isswitch:!0,current:h,status:R,steps:[{title:"Coordinación",className:"wizard-step-item",icon:e.jsx(Fe,{}),content:e.jsx(g,{justify:"center",children:e.jsxs(c,{sm:22,xs:24,children:[e.jsxs(F,{as:"h4",children:["1. Datos de la Coordinación ",z&&e.jsx(Q,{})]}),e.jsx($,{data:H,pairsPerRow:2})]})})},{title:"Información de Gavetas",className:"wizard-step-item",icon:e.jsx(Te,{}),content:e.jsx(De,{className:"basic-form-inner",style:{width:"80%"},children:e.jsx("div",{className:"atbd-form-checkout",children:e.jsx(g,{justify:"center",children:e.jsx(c,{sm:22,xs:24,children:e.jsxs("div",{className:"shipping-form",children:[e.jsx(F,{as:"h4",children:"2. Información de Gavetas"}),!a.showForm&&e.jsxs(x,{form:d,name:"drawerForm",children:[e.jsx("div",{style:{marginBottom:15},children:e.jsx(Ge,{showIcon:!0,icon:e.jsx(Ie,{}),message:"Cantidad de Gavetas",description:`El volumen de pesca es ${i?i.fishing_volume:""} lbs, cada gaveta tiene una capacidad máxima de 45 lbs, para poder enviar la información de esta coordinación necesita registrar al menos un total de ${a.suggestedDrawerCount} gaveta${a.suggestedDrawerCount>1?"s":""}.`,type:"info"})}),e.jsxs(g,{gutter:16,children:[e.jsx(c,{sm:8,xs:24,children:e.jsx(x.Item,{name:"sm_ice",label:"Hielo (#Sacos)",rules:[{required:!0,message:"Por favor ingrese la cantidad de hielo"},{type:"integer",message:"Debe ser un número entero"}],children:e.jsx(M,{style:{width:"100%"},value:a.sm_ice,onChange:s=>u({...a,sm_ice:s})})})}),e.jsx(c,{sm:8,xs:24,children:e.jsx(x.Item,{name:"sm_metabisulfite",label:"Metabisulfitos (kg)",rules:[{required:!0,message:"Por favor ingrese la cantidad de metabisulfitos"},{type:"number",message:"Debe ser un número válido"}],children:e.jsx(M,{style:{width:"100%"},value:a.sm_metabisulfite,onChange:s=>u({...a,sm_metabisulfite:s})})})}),_.length>0?e.jsx(c,{sm:8,xs:24,children:e.jsx(x.Item,{name:"selectedTreater",label:"Seleccionar Tratador",rules:[{required:!0,message:"Por favor seleccione un tratador"}],children:e.jsx(b,{loading:ae,placeholder:"Selecciona un tratador",allowClear:!0,value:a.selectedTreater,onChange:s=>u({...a,selectedTreater:s}),children:_==null?void 0:_.map(s=>e.jsx(b.Option,{value:s.value,children:s==null?void 0:s.label},s==null?void 0:s.value))})})}):null]})]}),a.showForm&&e.jsx(x,{form:d,name:"binform",children:e.jsxs(Me,{children:[e.jsxs(g,{justify:"center",gutter:16,style:{marginBottom:15},children:[e.jsx(c,{xs:24,sm:24,md:8,lg:8,xl:7,className:"gutter-row",children:e.jsx(x.Item,{label:"Transportista",name:"carrier",rules:[{required:!0,message:"Seleccione un transportista"}],children:e.jsx(b,{placeholder:"Selecciona Transportista",onChange:s=>{se(s),d.setFieldsValue({vehicle:void 0})},value:C,children:y.map(s=>e.jsx(b.Option,{value:s.id,children:s.Name},s.id))})})}),e.jsx(c,{xs:24,sm:24,md:8,lg:8,xl:7,className:"gutter-row",children:e.jsx(x.Item,{label:"Furgón",name:"vehicle",rules:[{required:!0,message:"Seleccione un vehículo"}],children:e.jsx(b,{placeholder:"Selecciona Vehículo (solo VAN)",disabled:!C,value:d.getFieldValue("vehicle"),children:C&&((W=y.find(s=>s.id===C))==null?void 0:W.sm_vehicle.filter(s=>s.SM_VehicleType==="VAN").map(s=>e.jsxs(b.Option,{value:s.id,children:[s.SM_Model," - ",s.SM_DriverName]},s.id)))})})}),e.jsx(c,{xs:24,sm:24,md:8,lg:8,xl:5,className:"gutter-row",children:e.jsx(x.Item,{name:"drawerCaladas",label:"#Gavetas Caladas",rules:[{required:!0,message:"Por favor indique el número de gavetas caladas"}],children:e.jsx(M,{value:d.getFieldValue("drawerCaladas"),onChange:s=>{d.setFieldsValue({drawerCaladas:s})}})})}),e.jsx(c,{xs:24,sm:24,md:8,lg:8,xl:5,className:"gutter-row",children:e.jsx(x.Item,{name:"drawerSolidas",label:"#Gavetas Sólidas",rules:[{required:!0,message:"Por favor indique el número de gavetas sólidas"}],children:e.jsx(M,{value:d.getFieldValue("drawerSolidas"),onChange:s=>{d.setFieldsValue({drawerSolidas:s})}})})})]}),e.jsx(g,{justify:"center",gutter:16,style:{marginBottom:15},children:e.jsx(c,{xs:24,sm:24,md:12,lg:12,xl:12,className:"gutter-row",children:e.jsxs("div",{style:{marginBottom:15},children:[e.jsxs(N,{size:"default",type:"primary",onClick:()=>{d.validateFields().then(()=>{var v;const s=new Set([...w.map(l=>l.kitId),...D.map(l=>l.SM_SecurityKits_ID&&l.SM_SecurityKits_ID.id).filter(l=>l!=null)]),r=new Set([...w.map(l=>l.vehicleId),...D.map(l=>l.sm_vehicle_id).filter(l=>l!=null)]),t=re.filter(l=>!s.has(l.id)),n=ie.filter(l=>!r.has(l.id));if(t.length>0&&n.length>0){const l=t[0],I=d.getFieldValue("vehicle");if(r.has(I)){m.error("Este vehículo ya está asignado");return}const Y=((v=y.find(k=>k.id===C))==null?void 0:v.sm_vehicle.find(k=>k.id===I))||{},O={key:Date.now(),van:`${Y.SM_Model||""} - ${Y.SM_DriverName||""}`,kitCode:l.sm_kitcode,seal1:l.SM_Stamp1,seal2:l.SM_Stamp2,drawerCaladas:d.getFieldValue("drawerCaladas"),drawerSolidas:d.getFieldValue("drawerSolidas"),kitId:l.id,vehicleId:I};o(Ve(T,O,(k,ue)=>{k?(P([...w,O]),G(t.slice(1)),B(n.filter(me=>me.id!==I)),d.resetFields(["vehicle","drawerCaladas","drawerSolidas"])):console.log(ue)})),d.resetFields(["vehicle","drawerCaladas","drawerSolidas"])}else m.error("No hay kits o vehículos disponibles")}).catch(()=>{m.error("Revise los datos requeridos")})},children:[e.jsx(Ne,{}),"Guardar"]}),e.jsx(N,{size:"default",type:"default",onClick:()=>{K()},children:"Cancelar"})]})})})]})}),e.jsx("div",{style:{marginBottom:15,marginTop:15},children:!a.showForm&&e.jsxs(N,{size:"default",type:"primary",onClick:()=>{u({...a,showForm:!0,form:{...a.form,sealId:null,seal:null,van:null,drawers:0}})},children:[e.jsx(J,{}),"Nuevo Furgón"]})}),e.jsx(Z,{tableData:w,columns:L,rowSelection:!1},"furgon")]})})})})})},{title:"Resumen",className:"wizard-step-item",icon:e.jsx(Pe,{}),content:R!=="finish"?e.jsxs(p,{bodyStyle:{borderRadius:10},headless:!0,children:[e.jsxs(p,{headless:!0,children:[e.jsxs(F,{as:"h4",children:["1. Datos de la Coordinación ",z&&e.jsx(Q,{})]}),e.jsx($,{data:H,pairsPerRow:2})]}),e.jsxs(p,{headless:!0,children:[e.jsx("div",{children:e.jsx(F,{as:"h5",children:"2. Información de Gavetas"})}),e.jsxs(g,{gutter:18,children:[e.jsx(c,{sm:6,xs:24,children:e.jsx($,{data:ce,pairsPerRow:1})}),e.jsx(c,{sm:18,xs:24,children:e.jsx(Z,{tableData:w,columns:L,rowSelection:!1},"furgon")})]})]})]}):e.jsx(g,{justify:"center",style:{width:"100%"},children:e.jsx(c,{xl:21,xs:24,children:e.jsx("div",{className:"checkout-successful",children:e.jsx(p,{headless:!0,bodyStyle:{borderRadius:"20px"},children:e.jsxs(p,{headless:!0,children:[e.jsx("span",{className:"icon-success",children:e.jsx(Ee,{})}),e.jsx(F,{as:"h3",children:"Información de Gavetas enviada"})]})})})})})}],onNext:ne,onPrev:de,onDone:oe,isfinished:te})})})})})})})})})})})]})}export{Oe as default};
